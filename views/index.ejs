<section class="welcome-section">
  <h2>Welcome to The Inner Circle 
    <%= currentUser ? currentUser.first_name : "" %>
  </h2>

  <% if (!currentUser) { %>
    <p class="intro-text">
      To unlock our <strong>exclusive community</strong>, please
      <a href="/sign-up" class="link signup"><i class="fas fa-user-plus"></i> sign up</a> or
      <a href="/log-in" class="link signin"><i class="fas fa-sign-in-alt"></i> log in</a>.
    </p>
    <p class="why-join">
      Joining gives you access to:
    </p>
     <ul class="benefits">
  <li><i class="fas fa-lock"></i> Private messages from verified members</li>
  <li><i class="fas fa-user-secret"></i> Deep discussions, hidden threads, and community secrets</li>
  <li><i class="fas fa-trophy"></i> Recognition for contributing to the community</li>
</ul>

  <% } else { %>
    <p class="intro-text">
      Glad to have you inside, <strong><%= currentUser.first_name || currentUser.username %></strong> 
      <% if (currentUser && currentUser.is_admin) { %>
        <span class="admin-tag">üõ°Ô∏è You are an Admin!</span>
      <% } %>!
    </p>
    <p class="member-message">
      You can now explore the community, share your voice, and help shape The Inner Circle.
    </p>

    <% if (!currentUser.is_member) { %>
      <p class="call-action">üåü Become a <a href="/membership">member</a> today to unlock all features.</p>
    <% } %>

    <% if (!currentUser.is_admin) { %>
      <p class="call-action">üëë Want more power? Apply to <a href="/admin">become an admin</a>.</p>
    <% } %>

    <div class="action-links">
      <a href="/new-message" class="btn"><i class="fas fa-comments"></i> Post a New Message</a>
      <a href="/profile" class="btn"><i class="fas fa-user"></i> View Your Profile</a>
    </div>
  <% } %>
</section>

<hr />

<section class="messages">
  <h3><i class="fas fa-comments"></i>   Community Messages</h3>

  <% if (messages.length === 0) { %>
    <p>No messages have been posted yet. Be the first to say something!</p>
  <% } else { %>
    <% messages.forEach(message => { %>
      <div class="message-card">
        <h4><%= message.title %></h4>
        <p><%= message.content %></p>

        <small>
          <p class="username"><i class="fas fa-user"></i> By <%= message.username %></p>
          <% 
            const user = users.find(u => u.id === message.user_id);
            if (currentUser && user && user.is_member) { 
          %>
            <span class="badge member">(Member)</span>
          <% } %>
          <% if (currentUser && user && user.is_admin) { %>
            <span class="badge admin">(Admin)</span>
          <% } %>
        </small><br>

        <% if (currentUser && currentUser.id === message.user_id) { %>
          <a class="edit-btn" href="/message/<%= message.id %>/edit"><i class="fas fa-edit"></i>
 Edit</a>
        <% } %>

        <% if (currentUser && (currentUser.id === message.user_id || currentUser.is_admin)) { %>
          <form action="/message/<%= message.id %>/delete" method="POST" style="display:inline;">
            <button type="submit" onclick="return confirm('Are you sure you want to delete this message?')"><i class="fas fa-trash"></i> Delete</button>
          </form>
        <% } %>

        <small class="timestamp"><p class="time"><i class="fas fa-clock"></i> <%= new Date(message.created_at).toLocaleString() %></p></small>
      </div>
    <% }) %>
  <% } %>
</section>
